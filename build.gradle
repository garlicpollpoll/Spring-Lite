plugins {
    id 'java'
    id 'application'
}

group = 'com.springlite'
version = '1.0.0'
sourceCompatibility = '11'

repositories {
    mavenCentral()
}

dependencies {
    // Jetty ì„œë²„ ì˜ì¡´ì„±ë“¤
    implementation 'org.eclipse.jetty:jetty-server:9.4.44.v20210927'
    implementation 'org.eclipse.jetty:jetty-servlet:9.4.44.v20210927'
    implementation 'org.eclipse.jetty:jetty-webapp:9.4.44.v20210927'
    implementation 'org.eclipse.jetty:jetty-annotations:9.4.44.v20210927'
    
    // ğŸ”¥ JSP ì§€ì› ì˜ì¡´ì„±ë“¤ (Apache JSP ì—”ì§„ ì‚¬ìš©)
    implementation 'org.eclipse.jetty:apache-jsp:9.4.44.v20210927'
    implementation 'org.eclipse.jetty:apache-jstl:9.4.44.v20210927'
    
    // JSP API ë° EL (Expression Language)
    implementation 'javax.servlet.jsp:javax.servlet.jsp-api:2.3.3'
    implementation 'javax.el:javax.el-api:3.0.0'
    implementation 'org.glassfish:javax.el:3.0.0'
    
    // Servlet API
    implementation 'javax.servlet:javax.servlet-api:4.0.1'
    
    // Jackson for JSON processing
    implementation 'com.fasterxml.jackson.core:jackson-databind:2.15.2'
    implementation 'com.fasterxml.jackson.core:jackson-core:2.15.2'
    implementation 'com.fasterxml.jackson.core:jackson-annotations:2.15.2'
    
    // ğŸ”¥ H2 ë°ì´í„°ë² ì´ìŠ¤ (JDBC í…ŒìŠ¤íŠ¸ìš©)
    implementation 'com.h2database:h2:2.2.224'
    
    // ë¡œê¹… (ì„ íƒì‚¬í•­)
    implementation 'org.slf4j:slf4j-simple:1.7.36'
}

application {
    mainClass = 'com.springlite.demo.Application'
}

// ğŸ”¥ JSP ì»´íŒŒì¼ì„ ìœ„í•œ ì¶”ê°€ ì„¤ì •
compileJava {
    options.encoding = 'UTF-8'
    options.compilerArgs += ['-parameters']
}

// ì‹¤í–‰ ì‹œ JVM ì˜µì…˜ ì„¤ì •
run {
    systemProperty 'file.encoding', 'UTF-8'
    jvmArgs = [
        '-Dorg.eclipse.jetty.util.log.class=org.eclipse.jetty.util.log.StdErrLog',
        '-Dorg.eclipse.jetty.LEVEL=INFO'
    ]
}

// JAR ë¹Œë“œ ì„¤ì •
jar {
    manifest {
        attributes(
            'Main-Class': 'com.springlite.demo.Application'
        )
    }
    from {
        configurations.runtimeClasspath.collect { it.isDirectory() ? it : zipTree(it) }
    }
    duplicatesStrategy = DuplicatesStrategy.EXCLUDE
}

// ğŸ”¥ JDBC í…ŒìŠ¤íŠ¸ ì• í”Œë¦¬ì¼€ì´ì…˜ ì‹¤í–‰ íƒœìŠ¤í¬
task runJdbcTest(type: JavaExec) {
    description = 'Run JDBC Test Application'
    group = 'application'
    classpath = sourceSets.main.runtimeClasspath
    mainClass = 'com.springlite.demo.JdbcTestApp'
    systemProperty 'file.encoding', 'UTF-8'
    jvmArgs = [
        '-Dorg.eclipse.jetty.util.log.class=org.eclipse.jetty.util.log.StdErrLog',
        '-Dorg.eclipse.jetty.LEVEL=INFO'
    ]
}

// ğŸ”¥ AOP í…ŒìŠ¤íŠ¸ ì• í”Œë¦¬ì¼€ì´ì…˜ ì‹¤í–‰ íƒœìŠ¤í¬
task runAopTest(type: JavaExec) {
    description = 'Run AOP Test Application'
    group = 'application'
    classpath = sourceSets.main.runtimeClasspath
    mainClass = 'com.springlite.demo.AopTestApp'
    systemProperty 'file.encoding', 'UTF-8'
    jvmArgs = [
        '-Dorg.eclipse.jetty.util.log.class=org.eclipse.jetty.util.log.StdErrLog',
        '-Dorg.eclipse.jetty.LEVEL=INFO'
    ]
}

task runLifecycleTest(type: JavaExec) {
    description = 'Run Lifecycle Test Application'
    group = 'application'
    classpath = sourceSets.main.runtimeClasspath
    mainClass = 'com.springlite.demo.LifecycleTestApp'
    systemProperty 'file.encoding', 'UTF-8'
    jvmArgs = [
        '-Dorg.eclipse.jetty.util.log.class=org.eclipse.jetty.util.log.StdErrLog',
        '-Dorg.eclipse.jetty.LEVEL=INFO'
    ]
}

task printClasspath {
    doLast {
        configurations.runtimeClasspath.each { println it }
    }
}

// íŠ¸ëœì­ì…˜ í…ŒìŠ¤íŠ¸ ì‹¤í–‰ íƒœìŠ¤í¬
task runTransactionTest(type: JavaExec) {
    group = 'application'
    description = 'ğŸ”„ Spring Lite íŠ¸ëœì­ì…˜ ì‹œìŠ¤í…œ í…ŒìŠ¤íŠ¸ ì‹¤í–‰'
    classpath = sourceSets.main.runtimeClasspath
    mainClass = 'com.springlite.demo.TransactionTestApp'
    
    doFirst {
        println 'ğŸ”„ Spring Lite íŠ¸ëœì­ì…˜ ACID í…ŒìŠ¤íŠ¸ë¥¼ ì‹œì‘í•©ë‹ˆë‹¤!'
        println '==================================================='
    }
} 